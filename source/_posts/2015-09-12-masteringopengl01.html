---
title: "[PREVIEW] 掌握 OpenGL01"
date: 2015-09-12
layout: post
categories: 掌握 OpenGL
published: false
comments: 
---
<span style="background: red;">PREVIEW</span>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">目标 &#x2013; 构建 OpenGL 上下文</h2>
<div class="outline-text-2" id="text-1">
<p>
在开始学习 OpenGL 时, 创建 OpenGL 上下文是比较困难的一件事情. 幸好又了 GLFW 这个开源的
OpenGL 库, 可以让我们轻松地创建 OpenGL 上下文, 并且也可以处理键盘和鼠标等输入事件. 我们在本节内将通过 GLFW 来创建一个 OpenGL(4.1)的窗口. 
</p>

<p>
<!-- more -->
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">编译 GLFW</h2>
<div class="outline-text-2" id="text-2">
<p>
我们可以在<a href="http://www.glfw.org"> GLFW 网站</a> 找到<a href="https://github.com/glfw/glfw/releases/download/3.1.1/glfw-3.1.1.zip">下载链接</a>, 注意我们选用的为当前最新版本 3.1.1. 下载并解压. 这里需要指出的是, 建议大家可以浏览下 GLFW 的文档, 这对我们后续使用 GLFW 非常有帮助, 当然, 我在本文内也会解释重要的知识.
</p>

<p>
编译 GLFW 是需要 Xcode 的, 我这里使用的是 Xcode7. 同时我们需要使用 cmake, 如果你没有, 可以使用强大的 OS X 包管理系统<a href="http://brew.sh/index_zh-cn.html">Homebrew</a> 来安装.
</p>

<p>
<a href="http://www.glfw.org/docs/latest/compile.html#compile_generate">这里</a> 可以找到 GLFW 的编译指南, 也很简单：
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #F92672;">cd</span> &lt;<span style="color: #c68133;">glfw-root-dir</span>&gt;
<span style="color: #e86385;">mkdir</span> <span style="color: #00a7c4;">glfw-build</span>
<span style="color: #F92672;">cd</span> <span style="color: #00a7c4;">glfw-build</span>
<span style="color: #9f7fdf;">cmake</span> <span style="color: #00a790;">..</span>
<span style="color: #e7638e;">make</span>
</pre>
</div>

<p>
编译完成后, 可以在 glfw-build/src 下面找到 libglfw3.a 静态库文件, 以及&lt;glfw-root-dir&gt;/include
下的头文件. 稍后会用到这些文件.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">设置 Xcode 工程</h2>
<div class="outline-text-2" id="text-3">
<p>
使用 Xcode 建立一个新的 Command Line Tool 工程, 语言我们这里选择的是 C++. 将上面提到的 include
目录加入到项目的搜索路径, 将 libglfw3.a 以及 Cocoa, OpenGL, IOKit, CoreVideo 等 Framework 加入到项目 Link Binary With Libraries 里面. Xcode 的使用已经超出本文的讨论范围, 如果对 Xcode 不熟悉可以参阅其文档.
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">黑色的 OpenGL 窗口</h2>
<div class="outline-text-2" id="text-4">
<p>
根据 GLFW 官网给出<a href="http://www.glfw.org/documentation.html">简单的示例代码</a>, 很容易创建出我们的第一个 OpenGL 窗口.
</p>

<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #66D9EF;">int</span> <span style="color: #e66965;">main</span><span style="color: #A1EFE4;">(</span><span style="color: #66D9EF;">int</span> <span style="color: #be852d;">argc</span>, <span style="color: #e56a60;">const</span> <span style="color: #66D9EF;">char</span> * <span style="color: #e8676e;">argv</span><span style="color: #E6DB74;">[]</span><span style="color: #A1EFE4;">)</span> 
<span style="color: #A1EFE4;">{</span>
    <span style="color: #66D9EF;">GLFWwindow</span> *<span style="color: #00a8ac;">window</span>;

    <span style="color: #00a4db;">if</span><span style="color: #E6DB74;">(</span><span style="color: #E6DB74; font-weight: bold;">!</span><span style="color: #009ded;">glfwInit</span><span style="color: #66D9EF;">()</span><span style="color: #E6DB74;">)</span>
    <span style="color: #E6DB74;">{</span>
        <span style="color: #00a7b9;">return</span> -<span style="color: #AE81FF;">1</span>;
    <span style="color: #E6DB74;">}</span>

    <span style="color: #00a8ac;">window</span> = <span style="color: #0099f0;">glfwCreateWindow</span><span style="color: #E6DB74;">(</span><span style="color: #AE81FF;">960</span>, <span style="color: #AE81FF;">640</span>, <span style="color: #E6DB74;">"Tutorial 01"</span>, <span style="color: #00a8a4;">nullptr</span>, <span style="color: #00a8a4;">nullptr</span><span style="color: #E6DB74;">)</span>;
    <span style="color: #00a4db;">if</span><span style="color: #E6DB74;">(</span><span style="color: #E6DB74; font-weight: bold;">!</span><span style="color: #00a8ac;">window</span><span style="color: #E6DB74;">)</span>
    <span style="color: #E6DB74;">{</span>
        <span style="color: #819a32;">glfwTerminate</span><span style="color: #66D9EF;">()</span>;
        <span style="color: #00a7b9;">return</span> -<span style="color: #AE81FF;">1</span>;
    <span style="color: #E6DB74;">}</span>

    <span style="color: #00a785;">glfwMakeContextCurrent</span><span style="color: #E6DB74;">(</span><span style="color: #00a8ac;">window</span><span style="color: #E6DB74;">)</span>;

    <span style="color: #dd714e;">while</span> <span style="color: #E6DB74;">(</span><span style="color: #E6DB74; font-weight: bold;">!</span><span style="color: #b6892a;">glfwWindowShouldClose</span><span style="color: #66D9EF;">(</span><span style="color: #00a8ac;">window</span><span style="color: #66D9EF;">)</span><span style="color: #E6DB74;">)</span> 
    <span style="color: #E6DB74;">{</span>
        <span style="color: #75715E;">//</span><span style="color: #75715E;">glfwSwapBuffers(window);</span>
        <span style="color: #b08b28;">glfwPollEvents</span><span style="color: #66D9EF;">()</span>;
    <span style="color: #E6DB74;">}</span>

    <span style="color: #819a32;">glfwTerminate</span><span style="color: #E6DB74;">()</span>;

    <span style="color: #00a7b9;">return</span> <span style="color: #AE81FF;">0</span>;
<span style="color: #A1EFE4;">}</span>
</pre>
</div>

<p>
我们使用到了 GLFW 提供的 GLFWindow 类和 6 个函数.
</p>

<ul class="org-ul">
<li>glfwInit 初始化 glfw
</li>
<li>glfwCreateWindow 创建窗口
</li>
<li>glfwMakeContextCurrent 给当前窗口设置 OpenGL 上下文
</li>
<li>glfwPollEvents 处理系统消息, 键盘鼠标等事件
</li>
<li>glfwWindowShouldClose 检查窗口是否需要关闭
</li>
<li>glfwTerminate 结束退出
</li>
</ul>

<p>
大家可能注意到了我注释掉了 glfwSwapBuffers 函数的调用, 原因是未进行进一步设置前这个函数的调用, 会导致我屏幕狂闪, 是的, 闪瞎了我的钛合金狗眼.
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">设置 OpenGL 版本</h2>
<div class="outline-text-2" id="text-5">
<p>
在程序主循环之前我们调用下面代码获取当前 OpenGL 版本.
</p>

<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #89982e;">cout</span> &lt;&lt; <span style="color: #849930;">glGetString</span><span style="color: #A1EFE4;">(</span><span style="color: #629f44;">GL_VERSION</span><span style="color: #A1EFE4;">)</span> &lt;&lt; <span style="color: #00a6c9;">endl</span>;
</pre>
</div>

<p>
我的输出是: 2.1 NVIDIA-10.6.42 310.42.05f01，其中 2.1 表明了我们将要使用的 OpenGL 版本是
2.1.
</p>

<p>
如果你了解 OpenGL 的历史, 就会知道 2.1 是一个非常老的版本. 而我们所希望研究的是更为现代的
OpenGL, 比如, 我电脑上支持的最高版本 OpenGL 4.1.
</p>

<p>
我们在创建窗口之前, 调用下面代码:
</p>

<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #00a8ac;">glfwWindowHint</span><span style="color: #A1EFE4;">(</span><span style="color: #009bef;">GLFW_CONTEXT_VERSION_MAJOR</span>, <span style="color: #AE81FF;">4</span><span style="color: #A1EFE4;">)</span>;
<span style="color: #00a8ac;">glfwWindowHint</span><span style="color: #A1EFE4;">(</span><span style="color: #9383e4;">GLFW_CONTEXT_VERSION_MINOR</span>, <span style="color: #AE81FF;">1</span><span style="color: #A1EFE4;">)</span>;
<span style="color: #00a8ac;">glfwWindowHint</span><span style="color: #A1EFE4;">(</span><span style="color: #00a89f;">GLFW_OPENGL_FORWARD_COMPAT</span>, <span style="color: #a49027;">GL_TRUE</span><span style="color: #A1EFE4;">)</span>;
<span style="color: #00a8ac;">glfwWindowHint</span><span style="color: #A1EFE4;">(</span><span style="color: #e76867;">GLFW_OPENGL_PROFILE</span>, <span style="color: #00a7b3;">GLFW_OPENGL_CORE_PROFILE</span><span style="color: #A1EFE4;">)</span>;
</pre>
</div>

<p>
然后我们再观察 glGetString(GL_VERSION)的输出.
我的输出为 4.1 NVIDIA-10.6.42 310.42.05f01, 其中 4.1 表明了我们将要使用的 OpenGL 版本是
4.1. 太棒了, 可以使用最现代的 OpenGL 了.
</p>

<p>
大家可以在 Mac App Store 免费下载到 OpenGL Extensions Viewer, 利用这个软件可以方便地查看自己电脑所能支持的 OpenGL 版本.
</p>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">glfwSetErrorCallback 设置错误回调</h2>
<div class="outline-text-2" id="text-6">
<p>
调用 glfwSetErrorCallback 可以给 glfw 添加一个回调函数, 当有错误发生时, 我们可以得到通知.
我们在 main 函数前添加一个 glfw_error_callback 函数:
</p>

<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #8187e9;">extern</span> <span style="color: #E6DB74;">"C"</span>
<span style="color: #A1EFE4;">{</span>
    <span style="color: #00a785;">static</span> <span style="color: #66D9EF;">void</span> <span style="color: #00a2e1;">glfw_error_callback</span><span style="color: #E6DB74;">(</span><span style="color: #66D9EF;">int</span> <span style="color: #d57742;">error</span>, <span style="color: #e56a60;">const</span> <span style="color: #66D9EF;">char</span> *<span style="color: #c970c3;">desc</span><span style="color: #E6DB74;">)</span>
    <span style="color: #E6DB74;">{</span>
        <span style="color: #dd724d;">fprintf</span><span style="color: #66D9EF;">(</span><span style="color: #a29027;">stderr</span>, <span style="color: #E6DB74;">"Running got error: %d,\t %s\n"</span>, <span style="color: #d57742;">error</span>, <span style="color: #c970c3;">desc</span><span style="color: #66D9EF;">)</span>;
    <span style="color: #E6DB74;">}</span>
<span style="color: #A1EFE4;">}</span>
</pre>
</div>

<p>
在 glfwInit 初始化之后就可以设置错误发生时的回调.
</p>
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #50a24f;">glfwSetErrorCallback</span><span style="color: #A1EFE4;">(</span><span style="color: #00a2e1;">glfw_error_callback</span><span style="color: #A1EFE4;">)</span>
</pre>
</div>

<p>
为了能看到效果, 大家可以临时注释掉下面两行, 看下效果.
</p>
<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #00a8ac;">glfwWindowHint</span><span style="color: #A1EFE4;">(</span><span style="color: #00a89f;">GLFW_OPENGL_FORWARD_COMPAT</span>, <span style="color: #a49027;">GL_TRUE</span><span style="color: #A1EFE4;">)</span>;
<span style="color: #00a8ac;">glfwWindowHint</span><span style="color: #A1EFE4;">(</span><span style="color: #e76867;">GLFW_OPENGL_PROFILE</span>, <span style="color: #00a7b3;">GLFW_OPENGL_CORE_PROFILE</span><span style="color: #A1EFE4;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="todo TODO">TODO</span> 代码</h2>
<div class="outline-text-2" id="text-7">
<p>
[<a href="http://localhost:4000/2015/09/12/2015-09-12-masteringopengl01/">http://localhost:4000/2015/09/12/2015-09-12-masteringopengl01/</a>]
</p>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">其他</h2>
<div class="outline-text-2" id="text-8">
<p>
本文是系列文章的一部分, 您可以在下面链接找到本系列索引.
[<a href="http://young40.com">http://young40.com</a>]
</p>



<p>
ssssss
</p>
</div>
</div>
