<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>喜气羊羊 › 2d-x深读2:CCPlatformMacros.h</title>
  <meta name="author" content="Young40">
  
  <meta name="description" content="路径:cocos2d-2.1beta3-x-2.1.0/cocos2dx/include/ccConfig.h
路径:cocos2d-2.1beta3-x-2.1.0/cocos2dx/platform/mac/CCPlatformDefine.h //注意我是以mac平台研究的, 其他平台略有不同
路径:cocos2d-2.1beta3-x-2.1.0/cocos2dx/platform/CCPlatformMacros.h">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="2d-x深读2:CCPlatformMacros.h"/>
  <meta property="og:site_name" content="喜气羊羊"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="喜气羊羊" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5353535-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>


<body>
  <header id="header"><div class="meta inner">
  <h1><a href="/">喜气羊羊</a></h1>
  <h2 id="header-h2">游来游去</h2>
  <nav id="main-nav">
    <ul>
      
      <li><a href="/">首页</a></li>
      
      <li><a href="/archives">文章归档</a></li>
      
      <li><a href="http://photo.jiabin.tk">相册</a></li>
      
      <li><a href="/links">友情链接</a></li>
      
      <li><a href="/about">关于</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title">2d-x深读2:CCPlatformMacros.h</h1>
  

      
      <time datetime="2012-12-16T17:49:00.000Z">Dec 17 2012</time>
      
    </header>
    <div class="entry">
      
        <ul>
<li>路径:<code>cocos2d-2.1beta3-x-2.1.0/cocos2dx/include/ccConfig.h</code></li>
<li>路径:<code>cocos2d-2.1beta3-x-2.1.0/cocos2dx/platform/mac/CCPlatformDefine.h</code> //注意我是以mac平台研究的, 其他平台略有不同</li>
<li>路径:<code>cocos2d-2.1beta3-x-2.1.0/cocos2dx/platform/CCPlatformMacros.h</code><a id="more"></a>

</li>
</ul>
<figure class="highlight cpp"><figcaption><span>ccConfig.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> "platform/CCPlatformConfig.h"</span></div><div class="line"></div><div class="line"><span class="comment">//设置为1后会include CCPhysicsScript 和 CCPhysicsDebugNode 添加到物理引擎支持</span></div><div class="line"><span class="comment">//需要保证Chipmunk在搜索路径中</span></div><div class="line"><span class="preprocessor">#ifndef CC_ENABLE_CHIPMUNK_INTEGRATION</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_ENABLE_CHIPMUNK_INTEGRATION 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">//设置为1后会include CCPhysicsScript 添加到Box2D的支持</span></div><div class="line"><span class="comment">//同样需要保证Box2D会在搜索路径中</span></div><div class="line"><span class="preprocessor">#ifndef CC_ENABLE_BOX2D_INTEGRATION</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_ENABLE_BOX2D_INTEGRATION 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">/** </span></div><div class="line"> 设置为1后,2d学会维护一个OpenGL状态缓存来避免不必要的切换</div><div class="line"> 为了使用这个功能,需要用下列函数来替换GL的对应函数</div><div class="line">    - ccGLUseProgram() instead of glUseProgram()</div><div class="line">    - ccGLDeleteProgram() instead of glDeleteProgram()</div><div class="line">    - ccGLBlendFunc() instead of glBlendFunc()</div><div class="line">如果这个功能被禁止, 那么这些函数会直接调用对应的GL函数, 当然就没有缓存了</div><div class="line">打开这个功能能提高速度</div><div class="line">如果你的代码是从GL ES 1.1升级过来的, 保持这个功能被禁用. 如果各种功能正常的话, 你可以启用这个功能</div><div class="line">#ifndef CC_ENABLE_GL_STATE_CACHE</div><div class="line">#define CC_ENABLE_GL_STATE_CACHE 1</div><div class="line">#endif</div><div class="line"></div><div class="line">/**</div><div class="line">启用后,纹理的坐标会用这个公式来计算</div><div class="line">- texCoord.left = (rect.origin.x*2+1) / (texture.wide*2);</div><div class="line">- texCoord.right = texCoord.left + (rect.size.width*2-2)/(texture.wide*2);</div><div class="line"></div><div class="line">The same for bottom and top.</div><div class="line"></div><div class="line">This formula prevents artifacts by using 99% of the texture.</div><div class="line">The "correct" way to prevent artifacts is by using the spritesheet-artifact-fixer.py or a similar tool.</div><div class="line"></div><div class="line">受影响的类:</div><div class="line">- CCSprite / CCSpriteBatchNode and subclasses: CCLabelBMFont, CCTMXTiledMap</div><div class="line">- CCLabelAtlas</div><div class="line">- CCQuadParticleSystem</div><div class="line">- CCTileMap</div><div class="line">*/</div><div class="line"><span class="preprocessor">#ifndef CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">//默认0.5秒, 更新下FPS的数据. 数字越大FPS数据越可靠.</span></div><div class="line"><span class="preprocessor">#ifndef CC_DIRECTOR_STATS_INTERVAL</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_DIRECTOR_STATS_INTERVAL (0.5f)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">//FPS数据显示位置,默认左下</span></div><div class="line"><span class="preprocessor">#ifndef CC_DIRECTOR_FPS_POSITION</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_DIRECTOR_FPS_POSITION ccp(0,0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">/** @def CC_DIRECTOR_DISPATCH_FAST_EVENTS</span></div><div class="line"> If enabled, and only when it is used with CCFastDirector, the main loop will wait 0.04 seconds to</div><div class="line"> dispatch all the events, even if there are not events to dispatch.</div><div class="line"> If your game uses lot's of events (eg: touches) it might be a good idea to enable this feature.</div><div class="line"> Otherwise, it is safe to leave it disabled.</div><div class="line"> </div><div class="line"> To enable set it to 1. Disabled by default.</div><div class="line"> </div><div class="line"> @warning This feature is experimental</div><div class="line"> */</div><div class="line"><span class="preprocessor">#ifndef CC_DIRECTOR_DISPATCH_FAST_EVENTS</span></div><div class="line"> <span class="preprocessor">#<span class="keyword">define</span> CC_DIRECTOR_DISPATCH_FAST_EVENTS 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">/** @def CC_DIRECTOR_MAC_USE_DISPLAY_LINK_THREAD</span></div><div class="line">If enabled, cocos2d-mac will run on the Display Link thread. If disabled cocos2d-mac will run in its own thread.</div><div class="line"></div><div class="line">If enabled, the images will be drawn at the "correct" time, but the events might not be very responsive.</div><div class="line">If disabled, some frames might be skipped, but the events will be dispatched as they arrived.</div><div class="line"></div><div class="line">To enable set it to a 1, to disable it set to 0. Enabled by default.</div><div class="line"></div><div class="line">Only valid for cocos2d-mac. Not supported on cocos2d-ios.</div><div class="line"></div><div class="line">*/</div><div class="line"><span class="preprocessor">#ifndef CC_DIRECTOR_MAC_USE_DISPLAY_LINK_THREAD</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_DIRECTOR_MAC_USE_DISPLAY_LINK_THREAD 1</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">/** @def CC_NODE_RENDER_SUBPIXEL</span></div><div class="line"> If enabled, the CCNode objects (CCSprite, CCLabel,etc) will be able to render in subpixels.</div><div class="line"> If disabled, integer pixels will be used.</div><div class="line"> </div><div class="line"> To enable set it to 1. Enabled by default.</div><div class="line"> */</div><div class="line"><span class="preprocessor">#ifndef CC_NODE_RENDER_SUBPIXEL</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_NODE_RENDER_SUBPIXEL 1</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">/** @def CC_SPRITEBATCHNODE_RENDER_SUBPIXEL</span></div><div class="line"> If enabled, the CCSprite objects rendered with CCSpriteBatchNode will be able to render in subpixels.</div><div class="line"> If disabled, integer pixels will be used.</div><div class="line"> </div><div class="line"> To enable set it to 1. Enabled by default.</div><div class="line"> */</div><div class="line"><span class="preprocessor">#ifndef CC_SPRITEBATCHNODE_RENDER_SUBPIXEL</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SPRITEBATCHNODE_RENDER_SUBPIXEL    1</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">/** @def CC_TEXTURE_ATLAS_USE_TRIANGLE_STRIP</span></div><div class="line"> Use GL_TRIANGLE_STRIP instead of GL_TRIANGLES when rendering the texture atlas.</div><div class="line"> It seems it is the recommend way, but it is much slower, so, enable it at your own risk</div><div class="line"> </div><div class="line"> To enable set it to a value different than 0. Disabled by default.</div><div class="line"></div><div class="line"> */</div><div class="line"><span class="preprocessor">#ifndef CC_TEXTURE_ATLAS_USE_TRIANGLE_STRIP</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_TEXTURE_ATLAS_USE_TRIANGLE_STRIP 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">//VAO定点数组对象</span></div><div class="line"><span class="comment">/** @def CC_TEXTURE_ATLAS_USE_VAO</span></div><div class="line"> By default, CCTextureAtlas (used by many cocos2d classes) will use VAO (Vertex Array Objects).</div><div class="line"> Apple recommends its usage but they might consume a lot of memory, specially if you use many of them.</div><div class="line"> So for certain cases, where you might need hundreds of VAO objects, it might be a good idea to disable it.</div><div class="line"> </div><div class="line"> To disable it set it to 0. Enabled by default.</div><div class="line"> </div><div class="line"> */</div><div class="line"><span class="preprocessor">#ifndef CC_TEXTURE_ATLAS_USE_VAO</span></div><div class="line">    <span class="preprocessor">#<span class="keyword">if</span> (CC_TARGET_PLATFORM == CC_PLATFORM_IOS) || (CC_TARGET_PLATFORM == CC_PLATFORM_MAC)</span></div><div class="line">        <span class="preprocessor">#<span class="keyword">define</span> CC_TEXTURE_ATLAS_USE_VAO 1</span></div><div class="line">    <span class="preprocessor">#<span class="keyword">else</span></span></div><div class="line">        <span class="comment">/* Some Windows display adapter driver cannot support VAO. */</span></div><div class="line">        <span class="comment">/* Some android devices cannot support VAO very well, so we disable it by default for android platform. */</span></div><div class="line">        <span class="comment">/* Blackberry also doesn't support this feature. */</span></div><div class="line">		<span class="preprocessor">#<span class="keyword">define</span> CC_TEXTURE_ATLAS_USE_VAO 0</span></div><div class="line">    <span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/** @def CC_USE_LA88_LABELS</span></div><div class="line"> If enabled, it will use LA88 (Luminance Alpha 16-bit textures) for CCLabelTTF objects.</div><div class="line"> If it is disabled, it will use A8 (Alpha 8-bit textures).</div><div class="line"> LA88 textures are 6% faster than A8 textures, but they will consume 2x memory.</div><div class="line"></div><div class="line"> This feature is enabled by default.</div><div class="line"></div><div class="line"> @since v0.99.5</div><div class="line"> */</div><div class="line"><span class="preprocessor">#ifndef CC_USE_LA88_LABELS</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_USE_LA88_LABELS 1</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">  启用后,所有CCSprite的子类都会花上一个边框,方便调试</div><div class="line"> 0 -- disabled</div><div class="line"> 1 -- draw bounding box</div><div class="line"> 2 -- draw texture box</div><div class="line">*/</div><div class="line"><span class="preprocessor">#ifndef CC_SPRITE_DEBUG_DRAW</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SPRITE_DEBUG_DRAW 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">//CCSpriteBatchNode的调试用加边框</span></div><div class="line"><span class="preprocessor">#ifndef CC_SPRITEBATCHNODE_DEBUG_DRAW</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SPRITEBATCHNODE_DEBUG_DRAW 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">//CCLabelBMFont调试加边框</span></div><div class="line"><span class="preprocessor">#ifndef CC_LABELBMFONT_DEBUG_DRAW</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_LABELBMFONT_DEBUG_DRAW 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">//LabeltAtlas调试加边框</span></div><div class="line"><span class="preprocessor">#ifndef CC_LABELATLAS_DEBUG_DRAW</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_LABELATLAS_DEBUG_DRAW 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">/** @def CC_ENABLE_PROFILERS</span></div><div class="line"> If enabled, will activate various profilers within cocos2d. This statistical data will be output to the console</div><div class="line"> once per second showing average time (in milliseconds) required to execute the specific routine(s).</div><div class="line"> Useful for debugging purposes only. It is recommended to leave it disabled.</div><div class="line"> </div><div class="line"> To enable set it to a value different than 0. Disabled by default.</div><div class="line"> */</div><div class="line"><span class="preprocessor">#ifndef CC_ENABLE_PROFILERS</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_ENABLE_PROFILERS 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">/** Enable Lua engine debug log */</span></div><div class="line"><span class="preprocessor">#ifndef CC_LUA_ENGINE_DEBUG</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_LUA_ENGINE_DEBUG 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div></pre></td></tr></table></figure>



<figure class="highlight cpp"><figcaption><span>mac/CCPlatformDefine.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;assert.h&gt; <span class="comment">//引入assert</span></span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_DLL <span class="comment">//CC_DLL只在win32平台下有效</span></span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">if</span> CC_DISABLE_ASSERT &gt; 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_ASSERT(cond) <span class="comment">//禁用了assert</span></span></div><div class="line"><span class="preprocessor">#<span class="keyword">else</span></span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_ASSERT(cond) assert(cond) <span class="comment">//启用了assert</span></span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_UNUSED_PARAM(unusedparam) (void)unusedparam</span></div><div class="line"></div><div class="line"><span class="comment">//定义空指针</span></div><div class="line"><span class="preprocessor">#ifndef NULL</span></div><div class="line"><span class="preprocessor">#ifdef __cplusplus</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> NULL    0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">else</span></span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> NULL    ((void *)0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div></pre></td></tr></table></figure>

<p>我们可以看到win32中不同的部分比如<code>CC_DLL</code></p>
<figure class="highlight cpp"><figcaption><span>win32/CCPlatformDefine.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">if</span> defined(_USRDLL)</span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> CC_DLL     __declspec(dllexport)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">else</span>         /* use a DLL library */</span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> CC_DLL     __declspec(dllimport)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div></pre></td></tr></table></figure>

<p>Linux部分也是<code>CC_DLL</code>不同</p>
<figure class="highlight cpp"><figcaption><span>linux/CCPlatformDefine.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">if</span> defined(_USRDLL)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_DLL __attribute__ ((visibility ("default")))</span></div><div class="line"><span class="preprocessor">#<span class="keyword">else</span>         /* use a DLL library */</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_DLL __attribute__ ((visibility ("default")))</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div></pre></td></tr></table></figure>

<p>Android中比较不同的部分是<code>CC_ASSERT</code></p>
<figure class="highlight cpp"><figcaption><span>android/CCPlatformDefine.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_ASSERT(cond) \</span></div><div class="line"><span class="keyword">if</span> (! (cond)) \</div><div class="line">{ \</div><div class="line">    <span class="keyword">char</span> content[<span class="number">256</span>]; \</div><div class="line">    <span class="built_in">sprintf</span>(content, <span class="string">"%s function:%s line:%d"</span>, __FILE__, __FUNCTION__, __LINE__);  \</div><div class="line">    CCMessageBox(content, <span class="string">"Assert error"</span>); \</div><div class="line">}</div></pre></td></tr></table></figure>

<p>我们最后再来看下<code>CCPlatformMacros.h</code></p>
<figure class="highlight cpp"><figcaption><span>CCPlatformMacros.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> "ccConfig.h"</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> "CCPlatformConfig.h"</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> "CCPlatformDefine.h"</span></div><div class="line"></div><div class="line"><span class="comment">//CREATE_FUNC是2d-x的一个核心功能,一般采用例如`MySpriter *my = MySpriter::create()`的形式调用.</span></div><div class="line"><span class="comment">//这里的create()成员函数即是由CREATE_FUNC创建, 来达到让2d-x来管理内存分配的功能</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CREATE_FUNC(__TYPE__) \</span></div><div class="line"><span class="keyword">static</span> __TYPE__* create() \</div><div class="line">{ \</div><div class="line">    __TYPE__ *pRet = <span class="keyword">new</span> __TYPE__(); \</div><div class="line">    <span class="keyword">if</span> (pRet && pRet-&gt;init()) \</div><div class="line">    { \</div><div class="line">        pRet-&gt;autorelease(); \</div><div class="line">        <span class="keyword">return</span> pRet; \</div><div class="line">    } \</div><div class="line">    <span class="keyword">else</span> \</div><div class="line">    { \</div><div class="line">        <span class="keyword">delete</span> pRet; \</div><div class="line">        pRet = NULL; \</div><div class="line">        <span class="keyword">return</span> NULL; \</div><div class="line">    } \</div><div class="line">}</div><div class="line"><span class="comment">//早期版本还有一个NODE_FUNC完成和CREATE_FUNC一样的功能,已经废弃,不再讨论</span></div><div class="line"></div><div class="line"><span class="comment">//CC_ENABLE_CACHE_TEXTURE_DATA 只在Android上启用, 会缓存纹理</span></div><div class="line"><span class="preprocessor">#<span class="keyword">if</span> (CC_TARGET_PLATFORM == CC_PLATFORM_ANDROID)</span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> CC_ENABLE_CACHE_TEXTURE_DATA       1</span></div><div class="line"><span class="preprocessor">#<span class="keyword">else</span></span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> CC_ENABLE_CACHE_TEXTURE_DATA       0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">if</span> (CC_TARGET_PLATFORM == CC_PLATFORM_ANDROID) || (CC_TARGET_PLATFORM == CC_PLATFORM_WIN32)</span></div><div class="line"><span class="comment">//重新绑定indices, 避免在android和win32下glDrawElements函数crash的bug</span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> CC_REBIND_INDICES_BUFFER  1</span></div><div class="line"><span class="preprocessor">#<span class="keyword">else</span></span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> CC_REBIND_INDICES_BUFFER  0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">//常用宏定义</span></div><div class="line"><span class="preprocessor">#ifdef __cplusplus <span class="comment">//namespace只在C++中起作用</span></span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> NS_CC_BEGIN                     namespace cocos2d {</span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> NS_CC_END                       }</span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> USING_NS_CC                     using namespace cocos2d  <span class="comment">//应该尽量使用USING_NS_CC, 兼容性更好</span></span></div><div class="line"><span class="preprocessor">#<span class="keyword">else</span></span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> NS_CC_BEGIN </span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> NS_CC_END </span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> USING_NS_CC </span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span> </span></div><div class="line"></div><div class="line"><span class="comment">//成员函数快捷声明/定义宏</span></div><div class="line"><span class="comment">//多使用这些宏, 可以方便地定义出合乎面向对象原则的成员变量.</span></div><div class="line"><span class="comment">//需要注意的是这些调用了这些宏之后, 应该养成重新写public, private等标号的习惯. 因为之后的都会变成public</span></div><div class="line"><span class="comment">//定义的成员变量都是protected的</span></div><div class="line"><span class="comment">//只读的成员变量</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_PROPERTY_READONLY(varType, varName, funName)\</span></div><div class="line"><span class="keyword">protected</span>: varType varName;\</div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> varType get<span class="preprocessor">##funName(void);</span></div><div class="line"></div><div class="line"><span class="comment">//getter是为引用</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_PROPERTY_READONLY_PASS_BY_REF(varType, varName, funName)\</span></div><div class="line"><span class="keyword">protected</span>: varType varName;\</div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> <span class="keyword">const</span> varType& get<span class="preprocessor">##funName(void);</span></div><div class="line"></div><div class="line"><span class="comment">//可读可写成员变量</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_PROPERTY(varType, varName, funName)\</span></div><div class="line"><span class="keyword">protected</span>: varType varName;\</div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> varType get<span class="preprocessor">##funName(void);\</span></div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="built_in">set</span><span class="preprocessor">##funName(varType var);</span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_PROPERTY_PASS_BY_REF(varType, varName, funName)\</span></div><div class="line"><span class="keyword">protected</span>: varType varName;\</div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> varType get<span class="preprocessor">##funName(void);\</span></div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="built_in">set</span><span class="preprocessor">##funName(const varType& var);</span></div><div class="line"></div><div class="line"><span class="comment">//以上的getter,setter只有声明, 下面的这些带有定义</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SYNTHESIZE_READONLY(varType, varName, funName)\</span></div><div class="line"><span class="keyword">protected</span>: varType varName;\</div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> varType get<span class="preprocessor">##funName(void) const { return varName; }</span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SYNTHESIZE_READONLY_PASS_BY_REF(varType, varName, funName)\</span></div><div class="line"><span class="keyword">protected</span>: varType varName;\</div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> <span class="keyword">const</span> varType& get<span class="preprocessor">##funName(void) const { return varName; }</span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SYNTHESIZE(varType, varName, funName)\</span></div><div class="line"><span class="keyword">protected</span>: varType varName;\</div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> varType get<span class="preprocessor">##funName(void) const { return varName; }\</span></div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="built_in">set</span><span class="preprocessor">##funName(varType var){ varName = var; }</span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SYNTHESIZE_PASS_BY_REF(varType, varName, funName)\</span></div><div class="line"><span class="keyword">protected</span>: varType varName;\</div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> varType get<span class="preprocessor">##funName(void) const { return varName; }\</span></div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="built_in">set</span><span class="preprocessor">##funName(const varType& var){ varName = var; }</span></div><div class="line"></div><div class="line"><span class="comment">//setter中会retain一次var, 防止被gc回收.</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SYNTHESIZE_RETAIN(varType, varName, funName)    \</span></div><div class="line"><span class="keyword">private</span>: varType varName; \</div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> varType get<span class="preprocessor">##funName(void) const { return varName; } \</span></div><div class="line"><span class="keyword">public</span>: <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="built_in">set</span><span class="preprocessor">##funName(varType var)   \</span></div><div class="line">{ \</div><div class="line">    <span class="keyword">if</span> (varName != var) \</div><div class="line">    { \</div><div class="line">        CC_SAFE_RETAIN(var); \</div><div class="line">        CC_SAFE_RELEASE(varName); \</div><div class="line">        varName = var; \</div><div class="line">    } \</div><div class="line">} </div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SAFE_DELETE(p)            do { <span class="keyword">if</span>(p) { delete (p); (p) = 0; } } while(0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SAFE_DELETE_ARRAY(p)     do { <span class="keyword">if</span>(p) { delete[] (p); (p) = 0; } } while(0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SAFE_FREE(p)                do { <span class="keyword">if</span>(p) { free(p); (p) = 0; } } while(0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SAFE_RELEASE(p)            do { <span class="keyword">if</span>(p) { (p)-&gt;release(); } } while(0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SAFE_RELEASE_NULL(p)        do { <span class="keyword">if</span>(p) { (p)-&gt;release(); (p) = 0; } } while(0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_SAFE_RETAIN(p)            do { <span class="keyword">if</span>(p) { (p)-&gt;retain(); } } while(0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CC_BREAK_IF(cond)            <span class="keyword">if</span>(cond) break</span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> __CCLOGWITHFUNCTION(s, ...) \</span></div><div class="line">    CCLog(<span class="string">"%s : %s"</span>,__FUNCTION__, CCString::createWithFormat(s, <span class="preprocessor">##__VA_ARGS__)-&gt;getCString())</span></div><div class="line"></div><div class="line"><span class="comment">//这个宏定义要注意大小写, 会很容易和cocos2d::CCLog弄错, 因为代码提示的问题.</span></div><div class="line"><span class="comment">// cocos2d debug</span></div><div class="line"><span class="preprocessor">#<span class="keyword">if</span> !defined(COCOS2D_DEBUG) || COCOS2D_DEBUG == 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOG(...)       do {} while (0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOGINFO(...)   do {} while (0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOGERROR(...)  do {} while (0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOGWARN(...)   do {} while (0)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">elif</span> COCOS2D_DEBUG == 1</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOG(format, ...)      cocos2d::CCLog(format, ##__VA_ARGS__)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOGERROR(format,...)  cocos2d::CCLog(format, ##__VA_ARGS__)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOGINFO(format,...)   do {} while (0)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOGWARN(...) __CCLOGWITHFUNCTION(__VA_ARGS__)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">elif</span> COCOS2D_DEBUG &gt; 1</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOG(format, ...)      cocos2d::CCLog(format, ##__VA_ARGS__)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOGERROR(format,...)  cocos2d::CCLog(format, ##__VA_ARGS__)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOGINFO(format,...)   cocos2d::CCLog(format, ##__VA_ARGS__)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> CCLOGWARN(...) __CCLOGWITHFUNCTION(__VA_ARGS__)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span> <span class="comment">// COCOS2D_DEBUG</span></span></div><div class="line"></div><div class="line"><span class="comment">// Lua engine debug</span></div><div class="line"><span class="preprocessor">#<span class="keyword">if</span> !defined(COCOS2D_DEBUG) || COCOS2D_DEBUG == 0 || CC_LUA_ENGINE_DEBUG == 0</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> LUALOG(...)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">else</span></span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> LUALOG(format, ...)     cocos2d::CCLog(format, ##__VA_ARGS__)</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span> <span class="comment">// Lua engine debug</span></span></div><div class="line"></div><div class="line"><span class="comment">//定义废弃(deprecated)属性</span></div><div class="line"><span class="preprocessor">#<span class="keyword">if</span> defined(__GNUC__) && ((__GNUC__ &gt;= 4) || ((__GNUC__ == 3) && (__GNUC_MINOR__ &gt;= 1)))</span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> CC_DEPRECATED_ATTRIBUTE __attribute__((deprecated))</span></div><div class="line"><span class="preprocessor">#<span class="keyword">elif</span> _MSC_VER &gt;= 1400 <span class="comment">//vs 2005 or higher</span></span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> CC_DEPRECATED_ATTRIBUTE __declspec(deprecated) </span></div><div class="line"><span class="preprocessor">#<span class="keyword">else</span></span></div><div class="line">    <span class="preprocessor">#<span class="keyword">define</span> CC_DEPRECATED_ATTRIBUTE</span></div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div></pre></td></tr></table></figure>


      
    </div>
    
    <footer>
      <div class="alignleft">
      
  
  <div class="categories">
    <a href="/categories/Cocos2d-x/">Cocos2d-x</a>, <a href="/categories/Cocos2d-x/Cocos2d-x-源代码研究/">Cocos2d-x 源代码研究</a>
  </div>

      
      </div>
      <div class="clearfix"></div>
    </footer>
    
  </div>
</article>


<section id="comment">
  
            <!-- Duoshuo Comment BEGIN -->
            <div class="ds-thread"></div>
            <script type="text/javascript">
                var duoshuoQuery = {short_name:"jiabin"};
                (function() {
                    var ds = document.createElement('script');
                    ds.type = 'text/javascript';ds.async = true;
                    ds.src = 'http://static.duoshuo.com/embed.js';
                    ds.charset = 'UTF-8';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
                })();
            </script>
            <!-- Duoshuo Comment END -->
      
  
</section>

</div></div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer"><div class="inner"><div class="alignleft">
  <p>
  
    &copy; 2015 Young40
  
  </p>
  <p>
    Theme By <a href="http://jiabin.tk" >Byron</a> based on <a href="https://github.com/willerce/hexo-theme-noderce" >Noderce</a>
  </p>

</div>
<div class="clearfix"></div></div></footer>
  <script type="text/javascript">

</script>

</body>
</html>
